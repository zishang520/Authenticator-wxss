var _exports={};var Buffer=require('./Buffer.js');var charmap=function(alphabet,mappings){mappings=mappings||{};alphabet.split("").forEach(function(c,i){if(!(c in mappings))mappings[c]=i});return mappings};var rfc4648={alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",charmap:{0:14,1:8}};rfc4648.charmap=charmap(rfc4648.alphabet,rfc4648.charmap);var crockford={alphabet:"0123456789ABCDEFGHJKMNPQRSTVWXYZ",charmap:{O:0,I:1,L:1}};crockford.charmap=charmap(crockford.alphabet,crockford.charmap);function Decoder(options){this.buf=[];this.shift=8;this.carry=0;if(options){switch(options.type){case"rfc4648":this.charmap=_exports.rfc4648.charmap;break;case"crockford":this.charmap=_exports.crockford.charmap;break;default:throw new Error("invalid type");}if(options.charmap)this.charmap=options.charmap}}Decoder.prototype.charmap=rfc4648.charmap;Decoder.prototype.write=function(str){var charmap=this.charmap;var buf=this.buf;var shift=this.shift;var carry=this.carry;str.toUpperCase().split("").forEach(function(char){if(char=="=")return;var symbol=charmap[char]&0xff;shift-=5;if(shift>0){carry|=symbol<<shift}else if(shift<0){buf.push(carry|(symbol>>-shift));shift+=8;carry=(symbol<<shift)&0xff}else{buf.push(carry|symbol);shift=8;carry=0}});this.shift=shift;this.carry=carry;return this};Decoder.prototype.finalize=function(str){if(str){this.write(str)}if(this.shift!==8&&this.carry!==0){this.buf.push(this.carry);this.shift=8;this.carry=0}return this.buf};function Encoder(options){this.buf="";this.shift=3;this.carry=0;if(options){switch(options.type){case"rfc4648":this.alphabet=_exports.rfc4648.alphabet;break;case"crockford":this.alphabet=_exports.crockford.alphabet;break;default:throw new Error("invalid type");}if(options.alphabet)this.alphabet=options.alphabet;else if(options.lc)this.alphabet=this.alphabet.toLowerCase()}}Encoder.prototype.alphabet=rfc4648.alphabet;Encoder.prototype.write=function(buf){var shift=this.shift;var carry=this.carry;var symbol;var byte;var i;for(i=0;i<buf.length;i++){byte=buf[i];symbol=carry|(byte>>shift);this.buf+=this.alphabet[symbol&0x1f];if(shift>5){shift-=5;symbol=byte>>shift;this.buf+=this.alphabet[symbol&0x1f]}shift=5-shift;carry=byte<<shift;shift=8-shift}this.shift=shift;this.carry=carry;return this};Encoder.prototype.finalize=function(buf){if(buf){this.write(buf)}if(this.shift!==3){this.buf+=this.alphabet[this.carry&0x1f];this.shift=3;this.carry=0}return this.buf};_exports.encode=function(buf,options){return new Encoder(options).finalize(buf)};_exports.decode=function(str,options){return new Decoder(options).finalize(str)};_exports.Decoder=Decoder;_exports.Encoder=Encoder;_exports.charmap=charmap;_exports.crockford=crockford;_exports.rfc4648=rfc4648;var finalizeDecode=_exports.Decoder.prototype.finalize;_exports.Decoder.prototype.finalize=function(buf){var bytes=finalizeDecode.call(this,buf);return new Buffer(bytes)};module.exports=_exports;